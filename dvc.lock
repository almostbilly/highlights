schema: '2.0'
stages:
  collect_train:
    cmd: python src/data/collector.py src/conf/params.yaml train
    deps:
    - path: src/data/collector.py
      hash: md5
      md5: ea7d3fb740548debedb60df2ef168506
      size: 1830
    params:
      src/conf/params.yaml:
        data_collector_config.n_batches: 100
        data_collector_config.video_id_train: '2039157631'
    outs:
    - path: data/raw/chat_train.csv
      hash: md5
      md5: 394266f62e38ad3805bb4ce1ed34782a
      size: 11638194
    - path: data/raw/clips_train.csv
      hash: md5
      md5: 750e031288fb5df470d60393765f70f2
      size: 139259
  collect_test:
    cmd: python src/data/collector.py src/conf/params.yaml test
    deps:
    - path: src/data/collector.py
      hash: md5
      md5: ea7d3fb740548debedb60df2ef168506
      size: 1830
    params:
      src/conf/params.yaml:
        data_collector_config.n_batches: 100
        data_collector_config.video_id_test: '2036131985'
    outs:
    - path: data/raw/chat_test.csv
      hash: md5
      md5: 3d5780374084eef01cf73fa4b1606930
      size: 4316059
    - path: data/raw/clips_test.csv
      hash: md5
      md5: 3364593ae9c452ae6f7be3043a4c0ebc
      size: 134748
  process_train:
    cmd: python src/features/process.py src/conf/params.yaml train
    deps:
    - path: data/raw/chat_train.csv
      hash: md5
      md5: 394266f62e38ad3805bb4ce1ed34782a
      size: 11638194
    - path: src/features/process.py
      hash: md5
      md5: 00edd32ae94defcf873c7c45a58d944e
      size: 1372
    params:
      src/conf/params.yaml:
        processing_config.paste_min_words: 3
        processing_config.window_size: 5
    outs:
    - path: data/processed/chat_train.csv
      hash: md5
      md5: c0d27f7a4a105995ad80443292031bfa
      size: 13031499
  process_test:
    cmd: python src/features/process.py src/conf/params.yaml test
    deps:
    - path: data/raw/chat_test.csv
      hash: md5
      md5: 3d5780374084eef01cf73fa4b1606930
      size: 4316059
    - path: src/features/process.py
      hash: md5
      md5: 00edd32ae94defcf873c7c45a58d944e
      size: 1372
    params:
      src/conf/params.yaml:
        processing_config.paste_min_words: 3
        processing_config.window_size: 5
    outs:
    - path: data/processed/chat_test.csv
      hash: md5
      md5: 309d0f74feeeba3e122be5aaa42a270c
      size: 4951085
  resample_train:
    cmd: python src/features/resample.py src/conf/params.yaml train
    deps:
    - path: data/processed/chat_train.csv
      hash: md5
      md5: c0d27f7a4a105995ad80443292031bfa
      size: 13031499
    - path: data/raw/clips_train.csv
      hash: md5
      md5: 750e031288fb5df470d60393765f70f2
      size: 139259
    - path: src/features/resample.py
      hash: md5
      md5: d71b6d07c1c8248bab81c4814898db55
      size: 4165
    params:
      src/conf/params.yaml:
        undersample_config.random_state: 42
    outs:
    - path: data/resampled/chat_train.csv
      hash: md5
      md5: d26d79852f0478904d4a67eacf8cc9b4
      size: 149825
  resample_test:
    cmd: python src/features/resample.py src/conf/params.yaml test
    deps:
    - path: data/processed/chat_test.csv
      hash: md5
      md5: 309d0f74feeeba3e122be5aaa42a270c
      size: 4951085
    - path: data/raw/clips_test.csv
      hash: md5
      md5: 3364593ae9c452ae6f7be3043a4c0ebc
      size: 134748
    - path: src/features/resample.py
      hash: md5
      md5: d71b6d07c1c8248bab81c4814898db55
      size: 4165
    outs:
    - path: data/resampled/chat_test.csv
      hash: md5
      md5: 214d4d110713228888cbe5347aedf248
      size: 696212
  train:
    cmd: python src/models/train.py -m
    deps:
    - path: data/resampled/chat_test.csv
      hash: md5
      md5: 214d4d110713228888cbe5347aedf248
      size: 696212
    - path: data/resampled/chat_train.csv
      hash: md5
      md5: d26d79852f0478904d4a67eacf8cc9b4
      size: 149825
    params:
      src/conf/models/log_reg.yaml:
        model:
          _target_: sklearn.linear.LogisticRegression
      src/conf/models/rf_clf.yaml:
        model:
          _target_: sklearn.ensemble.RandomForestClassifier
          max_depth: 7
          n_estimators: 400
      src/conf/models/xgb_clf.yaml:
        model:
          _target_: xgboost.XGBClassifier
          max_depth: 7
          n_estimators: 400
          objective: binary:logistic
          eval_metric: auc
      src/conf/search_spaces/log_reg.yaml:
        name: LogisticRegression
      src/conf/search_spaces/rf_clf.yaml:
        models.model.max_depth: range(7, 11, 2)
      src/conf/search_spaces/xgb_clf.yaml:
        name: XGBClassifier
        params:
          max_depth: 9
          n_estimators: 400
          objective: binary:logistic
          eval_metric: auc
  register:
    cmd: python src/models/register.py
