schema: '2.0'
stages:
  collect_train:
    cmd: python src/data/collector.py src/conf/params.yaml train
    deps:
    - path: src/data/collector.py
      hash: md5
      md5: ea7d3fb740548debedb60df2ef168506
      size: 1830
    params:
      src/conf/params.yaml:
        data_collector_config.n_batches: 100
        data_collector_config.video_id_train: '2039157631'
    outs:
    - path: data/raw/chat_train.csv
      hash: md5
      md5: ec77689149b0ccb9327c16ce45d60d3b
      size: 11636304
    - path: data/raw/clips_train.csv
      hash: md5
      md5: 864f33d36c7fec3d464007b2763e8be2
      size: 136979
  collect_test:
    cmd: python src/data/collector.py src/conf/params.yaml test
    deps:
    - path: src/data/collector.py
      hash: md5
      md5: ea7d3fb740548debedb60df2ef168506
      size: 1830
    params:
      src/conf/params.yaml:
        data_collector_config.n_batches: 100
        data_collector_config.video_id_test: '2036131985'
    outs:
    - path: data/raw/chat_test.csv
      hash: md5
      md5: 4f715f2d0d2516457c327e555ed70b19
      size: 4313163
    - path: data/raw/clips_test.csv
      hash: md5
      md5: cffeb8df405beb0eaea7f9dd94eb3734
      size: 134470
  process_train:
    cmd: python src/features/process.py src/conf/params.yaml train
    deps:
    - path: data/raw/chat_train.csv
      hash: md5
      md5: ec77689149b0ccb9327c16ce45d60d3b
      size: 11636304
    - path: src/features/process.py
      hash: md5
      md5: 00edd32ae94defcf873c7c45a58d944e
      size: 1372
    params:
      src/conf/params.yaml:
        processing_config.paste_min_words: 3
        processing_config.window_size: 5
    outs:
    - path: data/processed/chat_train.csv
      hash: md5
      md5: 18766af9db4bf5953520171c84addf07
      size: 13030000
  process_test:
    cmd: python src/features/process.py src/conf/params.yaml test
    deps:
    - path: data/raw/chat_test.csv
      hash: md5
      md5: 4f715f2d0d2516457c327e555ed70b19
      size: 4313163
    - path: src/features/process.py
      hash: md5
      md5: 00edd32ae94defcf873c7c45a58d944e
      size: 1372
    params:
      src/conf/params.yaml:
        processing_config.paste_min_words: 3
        processing_config.window_size: 5
    outs:
    - path: data/processed/chat_test.csv
      hash: md5
      md5: aa9adf33eaf42f8dd452ad3cf6471bc5
      size: 4948207
  resample_train:
    cmd: python src/features/resample.py src/conf/params.yaml train
    deps:
    - path: data/processed/chat_train.csv
      hash: md5
      md5: 18766af9db4bf5953520171c84addf07
      size: 13030000
    - path: data/raw/clips_train.csv
      hash: md5
      md5: 864f33d36c7fec3d464007b2763e8be2
      size: 136979
    - path: src/features/resample.py
      hash: md5
      md5: d71b6d07c1c8248bab81c4814898db55
      size: 4165
    params:
      src/conf/params.yaml:
        undersample_config.random_state: 42
    outs:
    - path: data/resampled/chat_train.csv
      hash: md5
      md5: c639173689c09d7ab83bbd6df8ae1a83
      size: 147891
  resample_test:
    cmd: python src/features/resample.py src/conf/params.yaml test
    deps:
    - path: data/processed/chat_test.csv
      hash: md5
      md5: aa9adf33eaf42f8dd452ad3cf6471bc5
      size: 4948207
    - path: data/raw/clips_test.csv
      hash: md5
      md5: cffeb8df405beb0eaea7f9dd94eb3734
      size: 134470
    - path: src/features/resample.py
      hash: md5
      md5: d71b6d07c1c8248bab81c4814898db55
      size: 4165
    outs:
    - path: data/resampled/chat_test.csv
      hash: md5
      md5: 1456a0ff89823347f56035b233387612
      size: 696188
  train:
    cmd: python src/models/train.py -m
    deps:
    - path: data/resampled/chat_test.csv
      hash: md5
      md5: 1456a0ff89823347f56035b233387612
      size: 696188
    - path: data/resampled/chat_train.csv
      hash: md5
      md5: c639173689c09d7ab83bbd6df8ae1a83
      size: 147891
    params:
      src/conf/models/log_reg.yaml:
        model:
          _target_: sklearn.linear.LogisticRegression
      src/conf/models/rf_clf.yaml:
        model:
          _target_: sklearn.ensemble.RandomForestClassifier
          max_depth: 7
          n_estimators: 400
      src/conf/models/xgb_clf.yaml:
        model:
          _target_: xgboost.XGBClassifier
          max_depth: 7
          n_estimators: 400
          objective: binary:logistic
          eval_metric: auc
      src/conf/search_spaces/log_reg.yaml:
        name: LogisticRegression
      src/conf/search_spaces/rf_clf.yaml:
        models.model.max_depth: range(7, 13, 2)
      src/conf/search_spaces/xgb_clf.yaml:
        models.model.eval_metric: auc
        models.model.max_depth: range(7, 11, 2)
        models.model.n_estimators: 400
        models.model.objective: binary:logistic
    outs:
    - path: mlruns/566969222355301129
      hash: md5
      md5: 75f731519a31199ecc5976b5745a59c0.dir
      size: 25533
      nfiles: 289
  register:
    cmd: python src/models/register.py
    deps:
    - path: mlruns/566969222355301129
      hash: md5
      md5: 75f731519a31199ecc5976b5745a59c0.dir
      size: 25533
      nfiles: 289
    outs:
    - path: mlruns/models
      hash: md5
      md5: e5702cd194cb3b068c3604afe692cfac.dir
      size: 572
      nfiles: 2
